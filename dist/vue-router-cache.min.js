/*!
 * vue-router-cache.js v1.0.4
 * (c) 2019-2023 kallsave <415034609@qq.com>
 * Released under the MIT License.
 */
/*!
 * vue-router-cache.js v1.0.4
 * (c) 2019-2023 kallsave <415034609@qq.com>
 * Released under the MIT License.
 */
var e,t;e=this,t=function(){"use strict";var e=function(){},t={max:1/0,directionKey:"direction",isSingleMode:!0,isDebugger:!1,getHistoryStack:e,setHistoryStack:e};function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(o=r.key,i=void 0,"symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"))?i:String(i)),r)}var o,i}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;n(this,e),this.max=t,this.init()}return o(e,[{key:"init",value:function(){this.list=[]}},{key:"_unshift",value:function(e){return this.list.unshift(e),this.list.length>this.max?this.list.pop():null}},{key:"unshift",value:function(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t],r=this._unshift(n);r&&e.push(r)}return e}},{key:"shift",value:function(){return this.list.length?this.list.shift():null}},{key:"_remove",value:function(e){var t=this.list.indexOf(e);return-1!==t?this.list.splice(t,1)[0]:null}},{key:"remove",value:function(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t],r=this._remove(n);r&&e.push(r)}return e}},{key:"removeByIndex",value:function(e){return this.list[e]?this.list.splice(e,1)[0]:null}},{key:"removeBackUntil",value:function(e){var t=this.list.indexOf(e);return-1!==t?this.list.splice(0,t):this.list.splice(0)}},{key:"removeBackInclue",value:function(e){var t=this.list.indexOf(e);return-1!==t?this.list.splice(0,t+1):this.list.splice(0)}},{key:"removeBackByIndex",value:function(e){return e<=this.list.length-1?this.list.splice(0,e):this.list.splice(0)}},{key:"removeExclude",value:function(){for(var e=[],t=0;t<this.list.length;t++){var n=this.list[t];if(-1===Array.prototype.indexOf.call(arguments,n)){var r=this.list.splice(t,1)[0];Array.prototype.push.call(e,r),t--}}return e}},{key:"removeAll",value:function(){return this.list.splice(0)}},{key:"replace",value:function(e){var t=this.shift();return t?(this._unshift(e),t):null}},{key:"getHeader",value:function(){return this.list[0]}},{key:"getByIndex",value:function(e){return this.list[e]}},{key:"getFooter",value:function(){return this.list[this.list.length-1]}},{key:"getSize",value:function(){return this.list.length}},{key:"getStore",value:function(){return this.list}},{key:"getMax",value:function(){return this.max}},{key:"has",value:function(e){return-1!==this.list.indexOf(e)}},{key:"updateSize",value:function(e){this.max=e}},{key:"checkFull",value:function(){return this.max===this.list.length}}]),e}(),l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(r,e);var t=s(r);function r(){return n(this,r),t.apply(this,arguments)}return o(r,[{key:"_unshift",value:function(e){var t=this.list.indexOf(e);return-1!==t&&this.list.splice(t,1),this.list.unshift(e),this.list.length>this.max?this.list.pop():null}}]),r}(u);function f(e){return e===1/0||"number"==typeof e&&e>0&&(0|e)===e}function h(e,t,n){var r=e[t];Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){if(e!==r){var t=r;r=e,"function"==typeof n&&n(e,t)}}})}var v=new l(t.max),m=[],p=Object.create(null);h(t,"max",(function(e){v.updateSize(e)}));var y={resolveKeyFromRoute:function(e){return e.name?e.name:e.path},resolveKeyFromLocation:function(e){var n=t.router.resolve(e).route;return this.resolveKeyFromRoute(n)},removeGlobalCacheFromItem:function(e){for(var t=0;t<m.length;t++){var n=m[t].cache;n[e]&&(n[e].componentInstance&&n[e].componentInstance.$destroy(),n[e]=null,delete n[e])}},removeGlobalCacheFromList:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.removeGlobalCacheFromItem(n)}},shift:function(){var e=v.shift();e&&this.removeGlobalCacheFromItem(e)},_remove:function(e){var t=v.remove(e);t.length&&this.removeGlobalCacheFromList(t)},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=this.resolveKeyFromLocation(t);this._remove(n)}},_removeBackUntil:function(e){var t=v.removeBackUntil(e);t.length&&this.removeGlobalCacheFromList(t)},removeBackUntil:function(e){var t=this.resolveKeyFromLocation(e);this._removeBackUntil(t)},_removeBackInclue:function(e){var t=v.removeBackInclue(e);t.length&&this.removeGlobalCacheFromList(t)},removeBackInclue:function(e){var t=this.resolveKeyFromLocation(e);this._removeBackInclue(t)},removeBackByIndex:function(e){var t=v.removeBackByIndex(e);t.length&&this.removeGlobalCacheFromList(t)},_removeExclude:function(){var e=v.removeExclude.apply(v,arguments);e.length&&this.removeGlobalCacheFromList(e)},removeExclude:function(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t],r=this.resolveKeyFromLocation(n);e.push(r)}this._removeExclude.apply(this,e)},removeAll:function(){var e=v.removeAll();e.length&&this.removeGlobalCacheFromList(e)},getStore:function(){return{cache:m,stack:v.getStore()}},has:function(e){var t=this.resolveKeyFromLocation(e);return v.has(t)},skip:function(){this._isSkip=!0}};function d(e){console.error("%cerror: ".concat(e),"color: orange")}function g(e){console.log("%c".concat(e),"color: orange")}function k(e){return null!=e}function b(e,t){e.isDebugger&&g("all cache keys: ".concat(JSON.stringify(t.getStore())))}var x={name:"router-cache",abstract:!0,created:function(){this.cache=Object.create(null),m.push({cache:this.cache})},render:function(){for(var e,n=this.$slots.default,r=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];if(k(n)&&(k(n.componentOptions)||(r=n).isComment&&r.asyncFactory))return n}var r}(n),o=r||n&&n[0],i=this.$parent,a=0,c=!1;i&&i._routerRoot!==i;){var s=i.$vnode&&i.$vnode.data;s&&(s.routerView&&a++,i._inactive&&(c=!0)),i=i.$parent}var u=this.$route.matched[a];if(r&&u){if(y._isSkip)return y._isSkip=!1,b(t,v),o;if(t.isSingleMode)e=y.resolveKeyFromRoute(u);else{var f=y.resolveKeyFromRoute(u);p[f]||(p[f]=new l);var h=p[f].getByIndex(0);"back"===this.$route.params[t.directionKey]&&h?e=h:(e="".concat(f,"_").concat(p[f].getSize()),p[f].unshift(e))}if(this.cache[e])r.componentInstance=c?this.oldComponentInstance:this.cache[e].componentInstance,function(e,t){e.isDebugger&&g("using cache key: ".concat(t))}(t,e);else if(v.checkFull()){var m=v.getFooter();y._remove(m),c||(this.cache[e]=r,this.oldComponentInstance=r.componentInstance)}else c||(this.cache[e]=r,this.oldComponentInstance=r.componentInstance);v.unshift(e),r.data.routerCache=!0,r.data.keepAlive=!0}return b(t,v),o},beforeDestroy:function(){for(var e in this.cache)y._remove(e);for(var t,n=0;n<m.length;n++)if(this.cache===m[n]){t=n;break}m.splice(t,1)}},w=new u;h(t,"getHistoryStack",(function(e){var t=e();if(t)for(var n=t.length-1;n>-1;n--){var r=t[n];w.unshift(r)}}));var S=new(function(){function e(){n(this,e),this.map={}}return o(e,[{key:"on",value:function(e,t){this.map[e]?this.map[e].push(t):this.map[e]=[t]}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.map[e]&&this.map[e].forEach((function(e){e.apply(void 0,n)}))}}]),e}());window.addEventListener("hashchange",(function(){w.getByIndex(1)===window.location.href?S.emit("back"):S.emit("forward")}));var _="";S.on("back",(function(){_="back",w.shift(),t.setHistoryStack(w.getStore());var e=t.router.history.current;if(t.isSingleMode){var n=y.resolveKeyFromRoute(e);y._remove(n)}else{var r=y.resolveKeyFromRoute(e);if(p[r]){var o=p[r].shift();y._remove(o)}}})),S.on("forward",(function(){_="forward"}));var B=function(e,t){var n=t.router,r=t.directionKey,o=n.push.bind(n),i=n.replace.bind(n),a=n.go.bind(n);n.push=function(e,n,r){_="forward",t.isSingleMode&&y.has(e)&&y.removeBackInclue(e),o(e,n,r)},n.replace=function(e,n,r){_="replace",w.shift(),t.setHistoryStack(w.getStore()),y.shift(),t.isSingleMode&&y.has(e)&&y.removeBackInclue(e),i(e,n,r)},n.go=function(e){e>1?_="forward":e<-1&&(_="back",w.removeBackByIndex(-e),t.setHistoryStack(w.getStore()),y.removeBackByIndex(-e)),a(e)},n.beforeEach((function(e,t,n){window.setTimeout((function(){e.params[r]=_,n()}),16)})),h(n.history,"current",(function(){e.nextTick((function(){var e=document.URL;"back"!==_&&w.getHeader()!==e&&(w.unshift(e),t.setHistoryStack(w.getStore())),_="forward"}))}))};return{install:function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.installed||(e.installed=!0,r.router?f(r.max)?(Object.assign(t,r),n.prototype.$routerCache=y,n.component(x.name,x),B(n,t)):d("parameter max must be an integer"):d("parameter router is required"))},routerCache:y,version:"1.0.4"}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VueRouterCache=t();